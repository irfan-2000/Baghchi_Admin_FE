<!-- ROOT CONTAINER -->
<div class="relative h-screen w-screen bg-slate-900 font-sans overflow-hidden">

  <!-- ================= ADMIN JOIN OVERLAY ================= -->
  <div
    *ngIf="!hasAdminJoined"
    class="absolute inset-0 z-50 flex items-center justify-center
           bg-black/80 backdrop-blur-sm">

    <button
      (click)="joinAsAdmin()"
      class="px-10 py-4 bg-indigo-600 text-white text-lg
             font-semibold rounded-full shadow-xl
             hover:bg-indigo-700 transition">
      Start Live Class
    </button>
  </div>

  <!-- ================= MAIN LAYOUT ================= -->
  <!-- bottom padding added so footer never overlaps -->
  <div class="flex h-full w-full pb-24">

    <!-- ================= LEFT : LIVE BOARD ================= -->
    <div class="w-3/4 relative flex items-center justify-center p-4">

      <div
        class="w-full h-full bg-black rounded-2xl
               shadow-2xl overflow-hidden flex items-center justify-center">

        <video
          #screenPreview
          autoplay
          muted
          playsinline
          class="w-full h-full object-contain rounded-2xl">
        </video>
      </div>

      <!-- LIVE LABEL -->
      <div
        class="absolute top-4 left-4 bg-red-600/90
               text-white text-sm px-3 py-1
               rounded-full shadow">
        ğŸ”´ Live Board
      </div>

      <!-- CURRENT SPEAKER -->
      <div
        *ngIf="currentSpeaker"
        class="absolute top-4 right-4 z-40
               bg-black/70 text-white
               px-4 py-2 rounded-full
               text-sm shadow-lg">
        ğŸ—£ï¸ Speaking: {{ currentSpeaker }}
      </div>
    </div>

    <!-- ================= RIGHT : STUDENT + CHAT PANEL ================= -->
    <!-- RIGHT PANEL -->
<div class="w-1/4 bg-slate-800 border-l border-slate-700 flex flex-col">

  <!-- ================= TABS HEADER ================= -->
  <div class="flex border-b border-slate-700">
    <button
      (click)="activeTab = 'students'"
      class="flex-1 py-3 text-sm font-semibold transition"
      [class.bg-slate-900]="activeTab === 'students'"
      [class.text-indigo-400]="activeTab === 'students'"
      [class.text-slate-300]="activeTab !== 'students'">
      ğŸ‘¥ Students
    </button>

    <button
      (click)="activeTab = 'chat'"
      class="flex-1 py-3 text-sm font-semibold transition"
      [class.bg-slate-900]="activeTab === 'chat'"
      [class.text-indigo-400]="activeTab === 'chat'"
      [class.text-slate-300]="activeTab !== 'chat'">
      ğŸ’¬ Chat
    </button>
  </div>

  <!-- ================= STUDENTS TAB ================= -->
  <div
    *ngIf="activeTab === 'students'"
    class="flex-1 overflow-y-auto p-3 space-y-2">

    <div
      *ngFor="let s of students_data"
      class="flex items-center justify-between
             bg-slate-700/60 px-3 py-2 rounded-lg">

      <!-- NAME + STATUS -->
      <div>
        <div class="text-sm font-medium text-white">
          {{ s.name }}
        </div>

        <div
          class="text-xs"
          [class.text-green-400]="s.status === 'on'"
          [class.text-slate-400]="s.status === 'off'"
          [class.text-red-400]="s.status === 'locked'">

          {{
            s.status === 'on'
              ? 'Mic ON'
              : s.status === 'off'
                ? 'Mic OFF'
                : 'Muted by Admin'
          }}
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="flex gap-1">
        <button
          *ngIf="s.status !== 'locked'"
          class="px-2 py-1 text-xs rounded bg-red-600">
          Mute
        </button>

        <button
          *ngIf="s.status === 'locked'"
          class="px-2 py-1 text-xs rounded bg-green-600">
          Unmute
        </button>

        <button
          class="px-2 py-1 text-xs rounded bg-slate-600">
          Kick
        </button>
      </div>
    </div>

    <!-- ADMIN CONTROLS -->
    <div class="pt-3 border-t border-slate-700 flex gap-2">
      <button class="flex-1 py-2 text-sm rounded bg-red-700" (click)="muteAllStudents()">
        Mute All
      </button>
      <button class="flex-1 py-2 text-sm rounded bg-green-700" (click)="unmuteAllStudents()">
        Unmute All
      </button>
    </div>
  </div>

  <!-- ================= CHAT TAB ================= -->
<div
  *ngIf="activeTab === 'chat'"
  class="flex flex-col flex-1 min-h-0">

    <!-- CHAT MESSAGES -->
    <div (scroll)="onChatScroll()"
      #chatContainer
      class="flex-1 overflow-y-auto p-3 space-y-2 bg-slate-900">

      <div *ngFor="let msg of messages">
        <div class="text-xs text-slate-400">
          {{ msg.user }} â€¢ {{ msg.time }}
        </div>
        <div class="text-sm text-white">
          {{ msg.text }}
        </div>
      </div>
    </div>

    <!-- CHAT INPUT -->
    <div class="p-3 border-t border-slate-700">
      <input
        type="text"
        [(ngModel)]="chatInput"
        (keydown.enter)="sendMessage()"
        placeholder="Type a message and press Enter"
        class="w-full bg-slate-700 text-white
               text-sm px-3 py-2 rounded-lg
               outline-none focus:ring-2
               focus:ring-indigo-500">
    </div>
  </div>

</div>

    
  </div>

  <!-- ================= BOTTOM CONTROL BAR ================= -->
  <div
    class="absolute bottom-0 left-0 w-full z-40
           bg-slate-800 border-t border-slate-700
           flex items-center justify-center gap-4 p-4">

    <button
      class="px-6 py-2 rounded-full font-semibold
             bg-indigo-600 hover:bg-indigo-700
             text-white transition">
      Share Screen
    </button>

   <button
  (click)="toggleAdminMic()"
  class="px-6 py-2 rounded-full font-semibold text-white
         shadow-lg transition bg-indigo-600 hover:bg-indigo-700">
  {{ isMicOn ? 'ğŸ™ï¸ Mic ON' : 'ğŸ”‡ Mic OFF' }}
</button>


    <button
      class="px-4 py-2 rounded-full
             bg-slate-700 text-white hover:bg-slate-600">
      ğŸ¥ Camera
    </button>

    <button
      class="px-4 py-2 rounded-full
             bg-red-600 text-white hover:bg-red-700">
      End Class
    </button>
  </div>

  <!-- ADMIN AUDIO -->
  <audio #adminAudio autoplay></audio>

</div>
